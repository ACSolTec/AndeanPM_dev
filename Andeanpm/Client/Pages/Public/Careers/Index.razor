@page "/Careers"

@inject IJSRuntime JSRuntime
@inject IFormService FormService
@inject IBannerService BannerService
@inject NavigationManager NavigationManager
@inherits FragmentNavigationBase

<link href="css/ourpeople.css?v=@(DateTime.Now.ToString("MMddyyyyHHmmss"))" rel="stylesheet" />

<div class="container-fluid p-0">
    <Andeanpm.Client.Components.Public.Navbar OnMenuEvent="menuEvent" />
    <div class="@ContentClass()">
        <div class="d-block row m-0">
            <div class="perspective-100">
                <img id="com-01" class="banner z-index-m-2 paragraph-image-half" src="@banner.Url" />
            </div>
            <div class="centered d-none d-lg-block">
                <h1 class="paragraph-title align-end py-2">CARRERS</h1>
            </div>
        </div>
        <div class="row centered d-block d-lg-none ">
            <h1 class="paragraph-title align-end py-2">CARRERS</h1>
        </div>
        <div class="container p-0 mt-5 mt-5-4k">
            <div class="container container-form p-0 mb-5-4k">
                <div class="col-12 p-0 pt-5 justify-content-center">
                    <div id="Diversity" class="col-12 p-0 mb-5">
                        <div class="col-12 py-3">
                            <div class="w-100 paragraph-title background-gray bold px-2 px-5-4k py-3 white andean-gold-bar" style="letter-spacing: 2px;">DIVERSITY</div>
                            <div class="w-100 centrium-card col-12 px-5 px-5-4k py-3 px-sm-3">
                                <div class="paragraph-title bold text-right py-3" style="border-bottom: 1px solid black;">People and Diversity</div>
                                <div class="paragraph-content pb-3 pt-3 text-justify">Andean recognises that an inclusive workplace is a hallmark of the future-ready organization. Our people are our most valuable resource and essential to our success. Establishing the Andean culture will allow us to do more and be aligned which will enhance our business outcomes.</div>
                                <div class="paragraph-content bold pt-3 text-right"><a href="/Governance#peopleAndDiversityDetail" class="a-remover yellow-hover">View more >></a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container container-form p-0">
                <div class="col-12 pt-5 justify-content-center">
                    <div class="col-12 p-0">
                        <div class="row m-0">
                            <div class="container-fluid p-5" style="background-color: #AD8400;">
                                <div class="row m-0 justify-content-center">
                                    <div class="col-12  p-0 ">
                                        <div class="row m-0 py-0 white">
                                            <div class="col-12 col-lg-6 p-0 d-flex flex-column justify-content-center align-items-center px-0">
                                                <div class="paragraph-title align-self-start d-none d-lg-block">CAREERS</div>
                                                <div class="font-abhaya bold font-size-36 d-none d-lg-block">COME GROW<br>WITH US!</div>
                                                <div class="paragraph-title font-size-26 text-center d-block d-lg-none my-3">CAREERS</div>
                                                <div class="font-abhaya bold font-size-26 text-center d-block d-lg-none my-3">COME GROW WITH US!</div>
                                            </div>
                                            <div class="col-12 col-lg-6 font-angkor p-0 d-flex justify-content-center align-items-center">
                                                <div class="our-people-career-description paragraph-content text-justify">
                                                    We are often looking for talented people to join our team.
                                                    If you would like to send us your resume, please use the links below to send an email to the human resources contact.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 px-sm-0">
                                <div class="col-12 p-0">
                                    <EditForm Model="application" OnValidSubmit="SendApplication">
                                        <DataAnnotationsValidator />
                                        @if (!success)
                                        {
                                            <div class="col-12 centrium-card centrium-card-border">
                                                <div class="col-12 my-4">
                                                    <div class="font-size-18-4k bold">Complete the information below to submit your resume</div>
                                                </div>
                                                <div class="col-12 my-2 p-0 d-lg-flex d-block">
                                                    <div class="col-12 col-lg-6 my-2">
                                                        <InputText @bind-Value="application.Name" class="andean-input w-100 p-2 font-assistant font-size-12" placeholder="Name" />
                                                        <ValidationMessage class="error" For="@(() => application.Name)" />
                                                    </div>
                                                    <div class="col-12 col-lg-6 my-2">
                                                        <InputText @bind-Value="application.Phone" class="andean-input w-100 p-2 font-assistant font-size-12" placeholder="Phone" />
                                                        <ValidationMessage class="error" For="@(() => application.Phone)" />
                                                    </div>
                                                </div>
                                                <div class="col-12 my-2 p-0 d-lg-flex d-block">
                                                    <div class="col-12 col-lg-6 my-2">
                                                        <InputText @bind-Value="application.Email" class="andean-input w-100 p-2 font-assistant font-size-12" placeholder="E-Mail" />
                                                        <ValidationMessage class="error" For="@(() => application.Email)" />
                                                    </div>
                                                    <div class="col-12 col-lg-6 my-2">
                                                        <InputSelect @bind-Value="application.ApplyFor" class="andean-input w-100 p-2 font-assistant font-size-12" style="color: gray;">
                                                            <option value="">Apply for...</option>
                                                            <option value="Bolivia">La Paz, Bo</option>
                                                            <option value="Mexico">Monterrey, Mx</option>
                                                            <option value="Canada">Toronto, Ca</option>
                                                        </InputSelect>
                                                        <ValidationMessage class="error" For="@(() => application.ApplyFor)" />
                                                    </div>
                                                </div>
                                                <div class="col-12 my-2">
                                                    <div class="paragraph-content">Attach resume:</div>
                                                </div>
                                                <div class="col-12 my-2">
                                                    <div class="andean-input p-2 font-assistant font-size-12 d-flex flex-column flex-lg-row align-items-center" style="color: gray;">
                                                        <label class="andean-button-yellow mr-2 f-100-4k" for="resume">SELECT FILE</label>
                                                        <InputFile OnChange="OnFileChange" name="fileInput" class="d-none" type="file" id="resume" accept="application/pdf" />
                                                        <div class="f-110-4k">@hasFile</div>
                                                    </div>
                                                    <label class="error validation-message">@vaildateFile</label>
                                                </div>
                                                <div class="col-12 d-flex my-3 mx-2">
                                                    <InputCheckbox @bind-Value="application.Privacy" type="checkbox" class="mr-2" />
                                                    <div class="font-size-12 font-assistant">
                                                        I consent to Andean Precious Metals Corp and retaining my personal details as described in the
                                                        <NavLink href="/CustomerCare#top" class="a-remover yellow-hover">Privacy Policy</NavLink>.
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <ValidationMessage class="error" For="@(() => application.Privacy)" />
                                                </div>
                                                <div class="col-12 d-flex">
                                                    <button type="submit" class="mx-2 andean-button-gray-blue text-center">
                                                        @if (submited)
                                                        {
                                                            <div class="spinner-border">
                                                                <span class="sr-only">Loading...</span>
                                                            </div>
                                                        }
                                                        SUBMIT
                                                    </button>
                                                </div>
                                            </div>
                                        }
                                    </EditForm>
                                    @if (success)
                                    {
                                        <div class="col-12 p-0 centrium-card centrium-card-border p-3 my-1 d-flex justify-content-center align-items-center" style="height: 100%;">
                                            <div class="col-6 d-flex flex-column justify-content-center">
                                                <div class="text-center justify-content-center mt-5">
                                                    <img src="assets/new-contact/hand.png" alt="" class="pb-4">
                                                </div>
                                                <div class="paragraph-content text-center my-5">You send succesfully your data application!</div>
                                                <div class="d-flex justify-content-center">
                                                    <button class="andean-button-yellow" @onclick="( () => Return())">BACK</button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <Andeanpm.Client.Components.Public.Footer isHome="@isHome" />
    </div>
</div>

@code {
    [Parameter]
    public bool isMenu { get; set; }

    [Parameter]
    public EventCallback<bool> OnMenuEvent { get; set; }

    private bool isHome = false;

    private string fragment = string.Empty;

    private string hasFile { get; set; } = string.Empty;

    private string vaildateFile { get; set; } = string.Empty;

    private bool isUploaded { get; set; } = false;

    private bool success = false;

    private bool submited = false;

    private Application application = new();

    private Banner banner { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(NavigationManager.Uri))
            fragment = UtilityFunctions.GetFragment(NavigationManager.Uri);

        hasFile = "No item attached";

        success = false;

        banner = await BannerService.GetBanner("Careers");
    }


    protected void menuEvent(bool eventMenu)
    {
        OnMenuEvent.InvokeAsync(eventMenu);
    }

    private string ContentClass()
    {
        if (isMenu) return "pause";
        return "";
    }

    private async Task OnFileChange(InputFileChangeEventArgs e)
    {
        if (e.File.ContentType != "application/pdf")
        {
            hasFile = "Please only upload PDF, JPG, or PNG images.";
            isUploaded = false;
        }
        else if (e.File.Size >= 31457280) // 31457280 bytes = 30 megabytes
        {
            hasFile = "Please only upload images that are smaller than 30 MegaBytes (MB).";
            isUploaded = false;
        }
        else{

            isUploaded = true;

            IBrowserFile uploadedImageFile = e.File;

            hasFile = uploadedImageFile.Name;

            byte[] imageAsByteArray = new byte[uploadedImageFile.Size];
            // Fills the contents of the image byte array.
            await uploadedImageFile.OpenReadStream(31457280).ReadAsync(imageAsByteArray);
            string byteString = Convert.ToBase64String(imageAsByteArray);

            Resume resume = new Resume()
            {
                NewImageFileExtension = uploadedImageFile.Name.Substring(uploadedImageFile.Name.Length - 4),
                NewImageBase64Content = byteString,
            };

            application.Resume = resume;

        }
    }

    private async Task SendApplication()
    {
        if (isUploaded)
        {
            submited = true;

            isUploaded = false;

            vaildateFile = string.Empty;

            var response = await FormService.Application(application);
            if (response)
            {
                application = new Application();
                hasFile = "No item attached";
                success = true;
                submited = false;
            }
            else
            {
                success = true;
            }

            application = new Application();

        }else{
            vaildateFile = "The resume is required";
        }

    }

    private void Return()
    {
        hasFile = "No item attached";
        isUploaded = false;
        submited = false;
        success = false;
    }
}